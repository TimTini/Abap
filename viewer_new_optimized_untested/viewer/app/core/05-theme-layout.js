"use strict";

(function (root) {
  const globalRoot = root || (typeof globalThis !== "undefined" ? globalThis : this);
  const registry = globalRoot.__AbapSourceParts = globalRoot.__AbapSourceParts || {};
  const targetKey = "viewer/app/01-core.js";
  const partKey = "viewer/app/core/05-theme-layout.js";
  const bucket = registry[targetKey] = registry[targetKey] || {};
  bucket[partKey] = "        J6: {\n          text: \"{extras.performCall.raising.name}\"\n        },\n        \"Y6:BG6\": createTemplateBaseStyle(\"#ffffff\"),\n        Y6: {\n          text: \"{extras.performCall.raising.valueDecl.finalDesc}\"\n        },\n        \"A7:I7\": createTemplateBaseStyle(\"#dbeef4\"),\n        A7: {\n          text: \"In Program\"\n        },\n        \"J7:X7\": createTemplateBaseStyle(\"#ffffff\"),\n        J7: {\n          text: \"{values.program.decl.name}\"\n        },\n        \"Y7:BG7\": createTemplateBaseStyle(\"#ffffff\"),\n        Y7: {\n          text: \"{values.program.finalDesc}\"\n        }\n      },\n      MESSAGE: {\n        _options: {\n          hideEmptyRows: true,\n          hideRowsWithoutValues: true,\n          expandMultilineRows: true\n        },\n        \"A1:I1\": createTemplateBaseStyle(\"#dbeef4\"),\n        A1: {\n          text: \"Message Class\"\n        },\n        \"J1:V1\": createTemplateBaseStyle(\"#ffffff\"),\n        J1: {\n          text: \"{values.messageClass.finalDesc}\"\n        },\n        \"W1:AB1\": createTemplateBaseStyle(\"#dbeef4\"),\n        W1: {\n          text: \"Message Number\"\n        },\n        \"AC1:AJ1\": createTemplateBaseStyle(\"#ffffff\"),\n        AC1: {\n          text: \"{values.messageNumber.finalDesc}\"\n        },\n        \"AK1:AQ1\": createTemplateBaseStyle(\"#dbeef4\"),\n        AK1: {\n          text: \"Message Type\"\n        },\n        \"AR1:AX1\": createTemplateBaseStyle(\"#ffffff\"),\n        AR1: {\n          text: \"{values.messageType.finalDesc}\"\n        },\n        \"AY1:BG1\": createTemplateBaseStyle(\"#dbeef4\"),\n        AY1: {\n          text: \"Display Like\"\n        },\n        \"BH1:BZ1\": createTemplateBaseStyle(\"#ffffff\"),\n        BH1: {\n          text: \"{values.displayLike.finalDesc}\"\n        },\n        \"A2:I2\": createTemplateBaseStyle(\"#dbeef4\"),\n        A2: {\n          text: \"Message Text &1\"\n        },\n        \"J2:BZ2\": createTemplateBaseStyle(\"#ffffff\"),\n        J2: {\n          text: \"{values.messageText1.finalDesc}\"\n        },\n        \"A3:I3\": createTemplateBaseStyle(\"#dbeef4\"),\n        A3: {\n          text: \"Message Text &2\"\n        },\n        \"J3:BZ3\": createTemplateBaseStyle(\"#ffffff\"),\n        J3: {\n          text: \"{values.messageText2.finalDesc}\"\n        },\n        \"A4:I4\": createTemplateBaseStyle(\"#dbeef4\"),\n        A4: {\n          text: \"Message Text &3\"\n        },\n        \"J4:BZ4\": createTemplateBaseStyle(\"#ffffff\"),\n        J4: {\n          text: \"{values.messageText3.finalDesc}\"\n        },\n        \"A5:I5\": createTemplateBaseStyle(\"#dbeef4\"),\n        A5: {\n          text: \"Message Text &4\"\n        },\n        \"J5:BZ5\": createTemplateBaseStyle(\"#ffffff\"),\n        J5: {\n          text: \"{values.messageText4.finalDesc}\"\n        },\n        \"A6:I6\": createTemplateBaseStyle(\"#dbeef4\"),\n        A6: {\n          text: \"Message Display\"\n        },\n        \"J6:BZ6\": createTemplateBaseStyle(\"#ffffff\"),\n        J6: {\n          text: \"{values.messageDisplay.finalDesc}\"\n        },\n        \"A7:I7\": createTemplateBaseStyle(\"#dbeef4\"),\n        A7: {\n          text: \"Đích lưu\"\n        },\n        \"J7:BZ7\": createTemplateBaseStyle(\"#ffffff\"),\n        J7: {\n          text: \"{values.messageDestination.finalDesc}\"\n        }\n      }\n    }\n  };\n\n  const TEMPLATE_GENERIC_KEYS = [\n    \"CALL_FUNCTION\",\n    \"CALL_METHOD\",\n    \"CALL_TRANSACTION\",\n    \"CASE\",\n    \"CATCH\",\n    \"CLASS\",\n    \"CLASS-DATA\",\n    \"CLASS-METHODS\",\n    \"CLEANUP\",\n    \"CLEAR\",\n    \"CONSTANTS\",\n    \"DATA\",\n    \"DO\",\n    \"ELSE\",\n    \"FIELD-SYMBOLS\",\n    \"FORM\",\n    \"INSERT_ITAB\",\n    \"LOOP_AT_ITAB\",\n    \"METHOD\",\n    \"METHODS\",\n    \"MOVE\",\n    \"MOVE-CORRESPONDING\",\n    \"PARAMETERS\",\n    \"PERFORM\",\n    \"RANGES\",\n    \"SELECT\",\n    \"SELECT-OPTIONS\",\n    \"SORT_ITAB\",\n    \"STATICS\",\n    \"TRY\",\n    \"TYPES\",\n    \"WHEN\"\n  ];\n\n  for (const key of TEMPLATE_GENERIC_KEYS) {\n    if (!Object.prototype.hasOwnProperty.call(TEMPLATE_DEFAULT_CONFIG_V1.templates, key)) {\n      TEMPLATE_DEFAULT_CONFIG_V1.templates[key] = createGenericStatementTemplate(key);\n    }\n  }\n\n  for (const templateDef of Object.values(TEMPLATE_DEFAULT_CONFIG_V1.templates)) {\n    if (!templateDef || typeof templateDef !== \"object\" || Array.isArray(templateDef)) {\n      continue;\n    }\n    const currentOptions = templateDef._options && typeof templateDef._options === \"object\" && !Array.isArray(templateDef._options)\n      ? templateDef._options\n      : {};\n    templateDef._options = { ...TEMPLATE_PREVIEW_DEFAULT_OPTIONS, ...currentOptions };\n  }\n\n  function setError(message) {\n    els.error.textContent = message ? String(message) : \"\";\n  }\n\n  function setOutputMessage(message) {\n    els.output.classList.add(\"muted\");\n    els.output.replaceChildren();\n    els.output.textContent = message || \"\";\n  }\n\n  function parseDateCandidate(value) {\n    const raw = String(value || \"\").trim();\n    if (!raw) {\n      return null;\n    }\n    const date = new Date(raw);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  function formatDateTime(value) {\n    const date = value instanceof Date ? value : parseDateCandidate(value);\n    if (!date) {\n      return \"\";\n    }\n    try {\n      return new Intl.DateTimeFormat(undefined, {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\"\n      }).format(date);\n    } catch {\n      return date.toLocaleString();\n    }\n  }\n\n  function getMetaContent(name) {\n    try {\n      const el = document.querySelector(`meta[name=\"${name}\"]`);\n      if (!el) {\n        return \"\";\n      }\n      return String(el.getAttribute(\"content\") || \"\").trim();\n    } catch {\n      return \"\";\n    }\n  }\n\n  function renderBuildInfo() {\n    if (!els.buildInfo) {\n      return;\n    }\n\n    const manualVersion = getMetaContent(\"abap-viewer-version\");\n    const manualUpdatedAt = getMetaContent(\"abap-viewer-updated-at\");\n    const manualNote = getMetaContent(\"abap-viewer-updated-note\");\n    const parsedManualDate = parseDateCandidate(manualUpdatedAt);\n    const fallbackDate = parseDateCandidate(document.lastModified);\n    const versionPrefix = manualVersion ? `${manualVersion} | ` : \"\";\n\n    if (manualUpdatedAt || manualVersion) {\n      const display = parsedManualDate ? formatDateTime(parsedManualDate) : manualUpdatedAt;\n      const updatedText = display || \"manual timestamp not set\";\n      els.buildInfo.textContent = `Updated: ${versionPrefix}${updatedText} (manual)`;\n      els.buildInfo.title = manualNote || \"Manual timestamp from <meta name=\\\"abap-viewer-updated-at\\\">.\";\n      return;\n    }\n\n    if (fallbackDate) {\n      els.buildInfo.textContent = `Updated: ${formatDateTime(fallbackDate)} (from document.lastModified)`;\n      els.buildInfo.title = \"No manual timestamp found. Showing document.lastModified.\";\n      return;\n    }\n\n    els.buildInfo.textContent = \"Updated: unknown\";\n    els.buildInfo.title = \"No manual timestamp and no document.lastModified available.\";\n  }\n\n  function normalizeId(id) {\n    if (id === null || id === undefined) {\n      return \"\";\n    }\n    return String(id);\n  }\n\n  function flattenEntryMap(map) {\n    if (!map || typeof map !== \"object\") {\n      return [];\n    }\n\n    const out = [];\n    for (const key of Object.keys(map)) {\n      const entryOrList = map[key];\n      if (Array.isArray(entryOrList)) {\n        for (const entry of entryOrList) {\n          if (entry && typeof entry === \"object\") {\n            out.push(entry);\n          }\n        }\n        continue;\n      }\n      if (entryOrList && typeof entryOrList === \"object\") {\n        out.push(entryOrList);\n      }\n    }\n    return out;\n  }\n\n  function getKeywordEntries(obj) {\n    if (!obj) {\n      return [];\n    }\n    if (Array.isArray(obj.keywords)) {\n      return obj.keywords;\n    }\n    return flattenEntryMap(obj.keywords);\n  }\n\n  function getValueEntries(obj) {\n    if (!obj) {\n      return [];\n    }\n    if (Array.isArray(obj.values)) {\n      return obj.values;\n    }\n    return flattenEntryMap(obj.values);\n  }\n\n  function getFirstValueFromValues(values, key) {\n    if (!values) {\n      return \"\";\n    }\n\n    if (Array.isArray(values)) {\n      const match = values.find((v) => v && v.name === key && v.value);\n      return match ? String(match.value) : \"\";\n    }\n\n    if (typeof values !== \"object\") {\n      return \"\";\n    }\n\n    const entryOrList = values[key];\n    const entry = Array.isArray(entryOrList) ? entryOrList[0] : entryOrList;\n    return entry && entry.value ? String(entry.value) : \"\";\n  }\n\n  function loadStorageObject(key) {\n    try {\n      const raw = localStorage.getItem(key);\n      if (!raw) {\n        return {};\n      }\n      const parsed = JSON.parse(raw);\n      return parsed && typeof parsed === \"object\" ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n\n  function loadDescOverrides() {\n    return loadStorageObject(DESC_STORAGE_KEY_V2);\n  }\n\n  function loadLegacyDescOverrides() {\n    return loadStorageObject(DESC_STORAGE_KEY_LEGACY_V1);\n  }\n\n  function saveDescOverrides() {\n    try {\n      localStorage.setItem(DESC_STORAGE_KEY_V2, JSON.stringify(state.descOverrides || {}));\n    } catch {\n      // ignore\n    }\n  }\n\n  function loadStorageArray(key) {\n    try {\n      const raw = localStorage.getItem(key);\n      if (!raw) {\n        return [];\n      }\n      const parsed = JSON.parse(raw);\n      return Array.isArray(parsed) ? parsed : [];\n    } catch {\n      return [];\n    }\n  }\n\n  function normalizeSettings(value) {\n    const input = value && typeof value === \"object\" && !Array.isArray(value) ? value : {};\n\n    const normalizeDeclDesc = typeof input.normalizeDeclDesc === \"boolean\"\n      ? input.normalizeDeclDesc\n      : DEFAULT_SETTINGS.normalizeDeclDesc;\n\n    const declFilterTypes = Array.isArray(input.declFilterTypes)\n      ? input.declFilterTypes\n          .map((t) => String(t || \"\").trim().toUpperCase())\n          .filter((t) => t && DECL_TYPE_OPTIONS.includes(t))\n      : [];\n\n    const structDescTemplate = typeof input.structDescTemplate === \"string\" && input.structDescTemplate.trim()\n      ? input.structDescTemplate\n      : DEFAULT_SETTINGS.structDescTemplate;\n\n    const nameTemplatesByCode = {};\n    const inputNameTemplates = input.nameTemplatesByCode && typeof input.nameTemplatesByCode === \"object\"\n      ? input.nameTemplatesByCode\n      : {};\n\n    for (const opt of NAME_CODE_OPTIONS) {\n      const code = opt.code;\n      const rawTemplate = Object.prototype.hasOwnProperty.call(inputNameTemplates, code)\n        ? inputNameTemplates[code]\n        : DEFAULT_SETTINGS.nameTemplatesByCode[code];\n\n      const template = typeof rawTemplate === \"string\" && rawTemplate.trim()\n        ? rawTemplate\n        : DEFAULT_SETTINGS.nameTemplatesByCode[code];\n\n      nameTemplatesByCode[code] = template;\n    }\n\n    return {\n      normalizeDeclDesc,\n      declFilterTypes: declFilterTypes.length ? declFilterTypes : DEFAULT_SETTINGS.declFilterTypes.slice(),\n      structDescTemplate,\n      nameTemplatesByCode\n    };\n  }\n\n  function loadSettings() {\n    return normalizeSettings(loadStorageObject(SETTINGS_STORAGE_KEY_V1));\n  }\n\n  function saveSettings(settings) {\n    try {\n      localStorage.setItem(SETTINGS_STORAGE_KEY_V1, JSON.stringify(settings || {}));\n    } catch {\n      // ignore\n    }\n  }\n\n  function setTemplateConfigError(message) {\n    if (!els.templateConfigError) {\n      return;\n    }\n    els.templateConfigError.textContent = message ? String(message) : \"\";\n  }\n\n  function setTemplatePreviewMessage(message) {\n    if (!els.templatePreviewOutput) {\n      return;\n    }\n    els.templatePreviewOutput.classList.add(\"muted\");\n    els.templatePreviewOutput.replaceChildren();\n    els.templatePreviewOutput.textContent = message || \"\";\n  }\n\n  function cloneJsonValue(value) {\n    try {\n      return JSON.parse(JSON.stringify(value));\n    } catch {\n      return null;\n    }\n  }\n\n  function getDefaultTemplateConfig() {\n    const cloned = cloneJsonValue(TEMPLATE_DEFAULT_CONFIG_V1);\n    return cloned && typeof cloned === \"object\" ? cloned : { version: 1, templates: {} };\n  }\n\n  function normalizeTemplateAliasToken(value) {\n    return String(value || \"\")\n      .trim()\n      .toLowerCase()\n      .normalize(\"NFD\")\n      .replace(/[\\u0300-\\u036f]/g, \"\")\n      .replace(/\\s+/g, \" \");\n  }\n";
})(typeof globalThis !== "undefined" ? globalThis : (typeof self !== "undefined" ? self : this));
